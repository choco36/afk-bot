<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Login Only</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>input,select{color:#111!important}.mc{background:#0e0e0f;color:#d7ffd7;border-radius:10px;padding:10px;height:50vh;overflow:auto;font-family:ui-monospace,Menlo,Consolas,monospace}</style>
</head>
<body class="bg-neutral-100 text-neutral-900 dark:bg-neutral-950 dark:text-neutral-100">
  <div class="max-w-xl mx-auto p-4 space-y-3">
    <a href="./" class="inline-block mb-2 px-3 py-1 rounded border">חזרה</a>
    <form id="loginForm" class="grid gap-2 panel p-3 border bg-white dark:bg-neutral-900 rounded">
      <input id="host" class="px-3 py-2 rounded border" placeholder="play.server.com" required />
      <input id="port" type="number" value="25565" class="px-3 py-2 rounded border" />
      <select id="auth" class="px-3 py-2 rounded border"><option value="microsoft">Microsoft (Online)</option><option value="offline">Offline</option></select>
      <input id="username" class="px-3 py-2 rounded border hidden" placeholder="שם משתמש (Offline)"/>
      <button class="px-4 py-2 rounded bg-blue-600 text-white">בצע התחברות</button>
    </form>
    <div id="loginConsole" class="mc">[LOGIN] מוכן.</div>
  </div>
  <script type="module">
    const $=s=>document.querySelector(s)
    const apiCreate= async cfg => { const r=await fetch('/api/sessions',{method:'POST',headers:{'Content-Type':'application/json'}, body:JSON.stringify(cfg)}); if(!r.ok) throw new Error((await r.json()).error||r.statusText); return r.json() }
    document.getElementById('auth').onchange=()=> document.getElementById('username').classList.toggle('hidden', document.getElementById('auth').value!=='offline')
    document.getElementById('loginForm').onsubmit=async e=>{
      e.preventDefault(); const cfg={ host:document.getElementById('host').value.trim(), port:Number(document.getElementById('port').value||25565), auth:document.getElementById('auth').value, username:document.getElementById('auth').value==='offline'?document.getElementById('username').value.trim():undefined, loginOnly:true, autoReconnect:false }
      const box=document.getElementById('loginConsole'); box.textContent+='\n[LOGIN] Connecting…'
      try{ const {id}=await apiCreate(cfg); box.textContent+='\n[LOGIN] id '+id }catch(e2){ box.textContent+='\n[ERROR] '+(e2?.message||e2) }
    }
  </script>
</body>
</html>
